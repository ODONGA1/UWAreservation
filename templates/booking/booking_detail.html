<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" ="width=device-width, initial-scale=1.0" />
    <title>Booking Details - UWA Reservation</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        max-width: 800px;
      }
      .booking-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
      }
      .status-pending {
        color: #ffc107;
      }
      .status-confirmed {
        color: #28a745;
      }
      .status-cancelled {
        color: #dc3545;
      }
      .status-completed {
        color: #007bff;
      }
      .btn {
        padding: 10px 15px;
        background: #007bff;
        color: white;
        text-decoration: none;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        margin: 5px;
      }
      .btn:hover {
        background: #0056b3;
      }
      .btn-success {
        background: #28a745;
      }
      .btn-danger {
        background: #dc3545;
      }
      .btn-secondary {
        background: #6c757d;
      }
      .payment-info {
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
      }
    </style>
  </head>
  <body>
    <h1>Booking Details</h1>

    <!-- Booking Information -->
    <div class="booking-info">
      <h3>Booking #{{ booking.booking_id }}</h3>
      <p>
        <strong>Status:</strong>
        <span class="status-{{ booking.booking_status }}"
          >{{ booking.get_booking_status_display }}</span
        >
      </p>
      <p>
        <strong>Payment Status:</strong>
        <span class="status-{{ booking.payment_status }}"
          >{{ booking.get_payment_status_display }}</span
        >
      </p>
      <p>
        <strong>Booked on:</strong> {{ booking.booking_date|date:"F d, Y \a\t g:i A" }}
      </p>
      {% if booking.confirmed_at %}
      <p>
        <strong>Confirmed on:</strong> {{ booking.confirmed_at|date:"F d, Y \a\t g:i A" }}
      </p>
      {% endif %}
    </div>

    <!-- Tour Information -->
    <div class="booking-info">
      <h3>Tour Details</h3>
      <p><strong>Tour:</strong> {{ booking.availability.tour.name }}</p>
      <p><strong>Park:</strong> {{ booking.availability.tour.park.name }}</p>
      <p><strong>Date:</strong> {{ booking.availability.date }}</p>
      <p>
        <strong>Duration:</strong> {{ booking.availability.tour.duration }} hours
      </p>
      {% if booking.availability.guide %}
      <p>
        <strong>Guide:</strong>
        {% if booking.availability.guide.user.first_name %}{{ booking.availability.guide.user.first_name }} {{ booking.availability.guide.user.last_name }}{% else %}{{ booking.availability.guide.user.username }}{% endif %}
      </p>
      <p>
        <strong>Guide Specialization:</strong> {{ booking.availability.guide.specialization }}
      </p>
      {% endif %}
    </div>

    <!-- Booking Details -->
    <div class="booking-info">
      <h3>Booking Information</h3>
      <p><strong>Number of People:</strong> {{ booking.num_of_people }}</p>
      <p><strong>Price per Person:</strong> ${{ booking.unit_price }}</p>
      <p><strong>Total Cost:</strong> ${{ booking.total_cost }}</p>
      <p><strong>Contact Email:</strong> {{ booking.contact_email }}</p>
      {% if booking.contact_phone %}
      <p><strong>Contact Phone:</strong> {{ booking.contact_phone }}</p>
      {% endif %} {% if booking.special_requirements %}
      <p>
        <strong>Special Requirements:</strong> {{ booking.special_requirements
        }}
      </p>
      {% endif %}
    </div>

    <!-- Payment Information -->
    {% if payment %}
    <div class="payment-info">
      <h3>Payment Information</h3>
      <p><strong>Payment ID:</strong> {{ payment.payment_id }}</p>
      <p>
        <strong>Amount:</strong> {{ payment.amount }} {{ payment.currency }}
      </p>
      <p>
        <strong>Payment Method:</strong> {{ payment.get_payment_method_display }}
      </p>
      <p>
        <strong>Status:</strong>
        <span class="status-{{ payment.status }}">{{ payment.get_status_display }}</span>
      </p>
      </p>
      {% if payment.gateway_transaction_id %}
      <p>
        <strong>Transaction ID:</strong> {{ payment.gateway_transaction_id }}
      </p>
      {% endif %}
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div style="margin-top: 20px">
      {% if booking.booking_status == 'pending' and booking.payment_status == 'pending' %}
      <a
        href="{% url 'booking:payment_selection' booking.booking_id %}"
        class="btn btn-success"
      >Pay Now</a>
      {% endif %}
      
      {% if booking.can_cancel %}
      <a
        href="{% url 'booking:cancel_booking' booking.booking_id %}"
        class="btn btn-danger"
      >Cancel Booking</a>
      {% endif %}

      <a href="{% url 'booking:user_bookings' %}" class="btn btn-secondary"
        >My Bookings</a
      >
      <a href="{% url 'booking:availability_list' %}" class="btn btn-secondary"
        >Browse Tours</a
      >
    </div>

    <!-- Booking Timeline -->
    {% if booking.booking_status != 'pending' %}
    <div class="booking-info">
      <h3>Booking Timeline</h3>
      <ul>
        <li>
          Booking created: {{ booking.booking_date|date:"F d, Y \a\t g:i A" }}
        </li>
        {% if booking.confirmed_at %}
        <li>
          Booking confirmed: {{ booking.confirmed_at|date:"F d, Y \a\t g:i A" }}
        </li>
        {% endif %} {% if booking.cancelled_at %}
        <li>
          Booking cancelled: {{ booking.cancelled_at|date:"F d, Y \a\t g:i A" }}
        </li>
        {% endif %}
      </ul>
    </div>
    {% endif %}
  </body>
</html>
