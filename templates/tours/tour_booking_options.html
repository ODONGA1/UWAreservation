<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book {{ tour.name }} - UWA Tours</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f8f9fa;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
      }
      .header {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }
      .tour-title {
        color: #007bff;
        margin: 0 0 10px 0;
        font-size: 2.5em;
      }
      .tour-subtitle {
        color: #6c757d;
        font-size: 1.2em;
        margin: 0;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }
      .stat-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        border-left: 4px solid #007bff;
      }
      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #007bff;
      }
      .stat-label {
        color: #6c757d;
        margin-top: 5px;
      }
      .availability-section {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }
      .section-title {
        color: #495057;
        margin-bottom: 20px;
        font-size: 1.3em;
      }
      .availability-grid {
        display: grid;
        gap: 20px;
      }
      .availability-card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        transition: all 0.3s;
      }
      .availability-card:hover {
        border-color: #007bff;
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.1);
      }
      .availability-date {
        font-size: 1.2em;
        font-weight: bold;
        color: #007bff;
        margin-bottom: 10px;
      }
      .availability-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
      }
      .info-item {
        color: #6c757d;
      }
      .info-value {
        font-weight: bold;
        color: #495057;
      }
      .availability-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }
      .btn {
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
        text-align: center;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .btn-primary {
        background-color: #007bff;
        color: white;
      }
      .btn-primary:hover {
        background-color: #0056b3;
      }
      .btn-success {
        background-color: #28a745;
        color: white;
      }
      .btn-success:hover {
        background-color: #218838;
      }
      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }
      .btn-secondary:hover {
        background-color: #545b62;
      }
      .btn-disabled {
        background-color: #e9ecef;
        color: #6c757d;
        cursor: not-allowed;
      }
      .no-availability {
        text-align: center;
        padding: 40px;
        color: #6c757d;
      }
      .navigation {
        text-align: center;
        margin: 30px 0;
      }
      .nav-link {
        display: inline-block;
        margin: 0 10px;
        padding: 10px 20px;
        background: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 5px;
      }
      .nav-link:hover {
        background: #0056b3;
      }
      .pagination {
        text-align: center;
        margin: 30px 0;
      }
      .pagination a,
      .pagination span {
        display: inline-block;
        padding: 8px 16px;
        margin: 0 4px;
        text-decoration: none;
        border: 1px solid #dee2e6;
        border-radius: 4px;
      }
      .pagination .current {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 class="tour-title">{{ tour.name }}</h1>
        <p class="tour-subtitle">
          üìç {{ tour.park.name }} ‚Ä¢ üí∞ ${{ tour.price }} per person
        </p>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-number">{{ total_available }}</div>
          <div class="stat-label">Available Dates</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ total_booked }}</div>
          <div class="stat-label">Fully Booked</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${{ tour.price }}</div>
          <div class="stat-label">Price per Person</div>
        </div>
        {% if tour.max_participants %}
        <div class="stat-card">
          <div class="stat-number">{{ tour.max_participants }}</div>
          <div class="stat-label">Max Group Size</div>
        </div>
        {% endif %}
      </div>

      <div class="navigation">
        <a href="{% url 'tours:tour_list' %}" class="nav-link">‚Üê All Tours</a>
        <a href="{% url 'tours:tour_detail' tour.id %}" class="nav-link"
          >üìã Tour Details</a
        >
        <a href="{% url 'booking:user_bookings' %}" class="nav-link"
          >üìã My Bookings</a
        >
      </div>

      {% if available_slots %}
      <div class="availability-section">
        <h2 class="section-title">üé´ Available Dates</h2>
        <div class="availability-grid">
          {% for availability in available_slots %}
          <div class="availability-card">
            <div class="availability-date">
              üìÖ {{ availability.date|date:"F d, Y (l)" }}
            </div>
            <div class="availability-info">
              <div class="info-item">
                <div>üë• Available Slots</div>
                <div class="info-value">
                  {{ availability.slots_available }} remaining
                </div>
              </div>
              {% if availability.guide %}
              <div class="info-item">
                <div>üéØ Guide</div>
                <div class="info-value">
                  {% if availability.guide.user.first_name %}{{ availability.guide.user.first_name }} {{ availability.guide.user.last_name }}{% else %}{{ availability.guide.user.username }}{% endif %}
                </div>
              </div>
              {% endif %}
              <div class="info-item">
                <div>üí∞ Total Cost</div>
                <div class="info-value">${{ tour.price }} √ó people</div>
              </div>
            </div>
            <div class="availability-actions">
              <a
                href="{% url 'booking:availability_detail' availability.id %}"
                class="btn btn-primary"
              >
                üëÅÔ∏è View Details
              </a>
              {% if availability.can_book %}
              <a
                href="{% url 'booking:create_booking' availability.id %}"
                class="btn btn-success"
              >
                üé´ Book This Date
              </a>
              {% else %}
              <button class="btn btn-disabled" disabled>
                üò¥ Not Available
              </button>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Pagination -->
      {% if page_obj.has_other_pages %}
      <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="?page=1">&laquo; first</a>
        <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">next</a>
        <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
      </div>
      {% endif %}
      {% else %}
      <div class="availability-section">
        <div class="no-availability">
          <h3>üò¥ No Available Dates</h3>
          <p>This tour doesn't have any available dates at the moment.</p>
          <p>Please check back later or contact us for more information.</p>
        </div>
      </div>
      {% endif %}
      {% if fully_booked %}
      <div class="availability-section">
        <h2 class="section-title">üìÖ Fully Booked Dates</h2>
        <div style="color: #6c757d; text-align: center; padding: 20px">
          {% for availability in fully_booked|slice:":5" %}
          {{ availability.date|date:"M d, Y" }}
          {% if not forloop.last %} ‚Ä¢ {% endif %}
          {% endfor %}
          {% if fully_booked.count > 5 %}
          <div style="margin-top: 10px">
            <em>... and {{ fully_booked.count|add:"-5" }} more dates</em>
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </body>
</html>
